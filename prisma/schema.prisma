datasource db {
  provider = "mongodb"
  url      = env("DATABASE_URL")
}

generator client {
  provider = "prisma-client-js"
}

model Department {
  id          String   @id @default(auto()) @map("_id") @db.ObjectId
  name        String
  description String?
  employees   DepartmentEmployees[]
  scanners    Scanner[]
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@map("departments")
}

model User {
  id           String                 @id @default(auto()) @map("_id") @db.ObjectId
  name         String
  username     String                 @unique
  designation  String
  rank         String
  password     String
  role         String
  inbox        String[]
  createdAt    DateTime               @default(now())
  updatedAt    DateTime               @updatedAt
  
  departments  DepartmentEmployees[]
  letters      Letter[]

  @@map("users")
}

model DepartmentEmployees {
  id           String     @id @default(auto()) @map("_id") @db.ObjectId
  department   Department @relation(fields: [departmentId], references: [id])
  departmentId String     @db.ObjectId
  user         User       @relation(fields: [userId], references: [id])
  userId       String     @db.ObjectId
  createdAt    DateTime   @default(now())
  updatedAt    DateTime   @updatedAt
}

model Letter {
  id           String   @id @default(auto()) @map("_id") @db.ObjectId
  subject      String   
  reference    String   
  priority     String
  fileLocation String   
  drafts       String?   
  remarks      String?  
  uploadedBy   User      @relation(fields: [uploadedById], references: [id])
  uploadedById String    @db.ObjectId
  scanners     Scanner[] 
  createdAt    DateTime  @default(now())
  updatedAt    DateTime  @updatedAt
}

model Scanner {
  id             String     @id @default(auto()) @map("_id") @db.ObjectId
  letter         Letter     @relation(fields: [letterId], references: [id])
  letterId       String     @db.ObjectId
  sendTo         String[] 
  sendBy         String     @db.ObjectId
  department     Department @relation(fields: [departmentId], references: [id])
  departmentId   String     @db.ObjectId
  subject        String
  reference      String
  createdAt      DateTime   @default(now())
  updatedAt      DateTime   @updatedAt
}
